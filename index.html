<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamond Nation Studios | Partnership Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Playfair+Display:wght@700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
          theme: {
            extend: {
              fontFamily: { sans: ['Inter', 'sans-serif'] }
            }
          }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f3f4f6;
            -webkit-font-smoothing: antialiased;
        }
        .paper {
            background: #ffffff;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        #capture-buffer {
            position: absolute;
            top: -9999px;
            left: -9999px;
            width: 850px; 
            background: white;
            color: black;
            padding: 80px;
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 12rem;
            font-weight: 900;
            color: rgba(0, 0, 0, 0.02); 
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }
        .header-font { font-family: 'Playfair Display', serif; }
        .signature-font { font-family: 'Dancing Script', cursive; }
        
        .checkbox-custom:checked + label .box {
            background-color: #1e3a8a;
            border-color: #1e3a8a;
        }
        .checkbox-custom:not(:checked) + label .box {
            border-color: #000;
        }

        /* LIVE UI LINE */
        .sig-container {
            border-bottom: 2px solid #000;
            display: flex;
            align-items: flex-end;
            height: 60px;
            width: 100%;
            position: relative;
        }
        
        #discordUsername {
            margin-bottom: -10px;
            line-height: 1;
            padding: 0;
            background: transparent;
            border: none;
            font-size: 2.25rem;
        }

        /* SNAPSHOT BUFFER - ALIGNMENT FIX */
        #buffer-signature {
            line-height: 0.8;
            display: inline-block;
            font-size: 84px;
            transform: translateY(-8px); /* Moves it slightly up from the baseline */
        }

        #downloadModal {
            backdrop-filter: blur(8px);
            background: rgba(0,0,0,0.6);
        }
    </style>
</head>
<body class="py-12 px-4 flex items-center justify-center">

    <!-- VISUAL INTERFACE -->
    <div id="ui-container" class="max-w-4xl w-full paper p-8 md:p-20 rounded-lg border-t-[12px] border-blue-900 transition-opacity duration-500">
        <div class="watermark">DNS</div>
        
        <div class="flex justify-between items-start mb-8 text-[10px] font-mono text-gray-500 uppercase tracking-widest">
            <div id="display-id">ID: GENERATING...</div>
            <div>STATUS: OFFICIAL ORIGINAL RECORD</div>
        </div>

        <div class="flex flex-col items-center mb-12">
            <div class="w-20 h-20 bg-blue-900 rounded-full flex items-center justify-center mb-6 shadow-lg">
                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
            </div>
            <h1 class="header-font text-4xl md:text-5xl text-black font-bold text-center">Partnership Agreement</h1>
            <p class="text-blue-800 font-bold tracking-[0.3em] uppercase text-xs mt-4">Diamond Nation Studios • Legal Department</p>
        </div>

        <div class="space-y-8 text-lg mb-16 border-l-4 border-blue-900 pl-6 text-gray-900 leading-relaxed text-justify">
            <p>
                By entering a partnership with <span class="font-bold text-blue-900">Diamond Nation Studios</span>, your server agrees to meet and maintain the eligibility requirement of having at least <span class="font-bold underline">fifteen members</span>, unless an exception is formally approved by the Founders of Diamond Nation Studios.
            </p>
            <p>
                Upon acceptance, you are required to fully comply with all branding standards set by DNS, which includes the mandatory use of all provided logos, decals, and promotional materials exactly as delivered, without alteration or redistribution of any kind. 
            </p>
            <p>
                Additionally, your server must establish a role titled <span class="bg-blue-900 px-3 py-1 rounded font-bold text-white uppercase tracking-tighter">"Diamond Nation"</span>, designated as the highest administrative role in your server, equipped with full administrative permissions to ensure proper oversight and coordination with DNS leadership. 
            </p>
            <p>
                All logos, decals, and branding assets remain the exclusive property of Diamond Nation Studios. Misuse of assets, failure to uphold branding requirements, or refusal to maintain proper administrative structure may result in <span class="text-red-700 font-bold uppercase underline">immediate removal</span> from the program.
            </p>
            <p>
                If the partnership is terminated, you are required to remove and replace every DNS-provided asset from your server, game, and documents within <span class="font-bold underline">48 hours</span>. 
            </p>
        </div>

        <div class="space-y-4 mb-12" id="requirements-section">
            <div class="flex items-start">
                <input type="checkbox" id="check1" class="hidden checkbox-custom">
                <label for="check1" class="flex items-start cursor-pointer group">
                    <div class="box w-6 h-6 border-2 rounded mr-3 mt-1 flex-shrink-0 flex items-center justify-center bg-white transition-colors">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                    <span class="text-sm font-bold group-hover:text-blue-900 transition-colors">I confirm my server maintains at least 15 active members or has a formal exception. <span class="text-red-500">*</span></span>
                </label>
            </div>
            <div class="flex items-start">
                <input type="checkbox" id="check2" class="hidden checkbox-custom">
                <label for="check2" class="flex items-start cursor-pointer group">
                    <div class="box w-6 h-6 border-2 rounded mr-3 mt-1 flex-shrink-0 flex items-center justify-center bg-white transition-colors">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"></path></svg>
                    </div>
                    <span class="text-sm font-bold group-hover:text-blue-900 transition-colors">I agree to the 48-hour asset removal policy upon termination of this partnership. <span class="text-red-500">*</span></span>
                </label>
            </div>
        </div>

        <form id="signatureForm">
            <div class="bg-gray-100 p-8 rounded-xl border-2 border-gray-300">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div class="relative pt-6">
                        <label class="absolute top-0 left-0 text-[10px] font-bold text-blue-900 uppercase tracking-widest">Official Signature</label>
                        <div class="sig-container">
                            <input type="text" id="discordUsername" required placeholder="Type Discord Username..." class="signature-font w-full text-black placeholder:text-gray-400 outline-none">
                        </div>
                    </div>
                    <div class="flex flex-col justify-end items-end">
                        <p id="currentDate" class="text-black font-bold mb-4 font-mono text-sm"></p>
                        <button type="submit" id="submitBtn" disabled class="w-full bg-blue-900 hover:bg-black text-white font-bold py-4 px-12 rounded-lg transition-all shadow-xl disabled:opacity-30 disabled:cursor-not-allowed">EXECUTE & ARCHIVE</button>
                    </div>
                </div>
            </div>
        </form>

        <footer class="mt-16 pt-8 border-t-2 border-black flex justify-between items-center text-[10px] text-black uppercase font-black">
            <span>&copy; <span id="year"></span> Diamond Nation Studios</span>
            <span class="font-mono" id="footer-id">DOC-ID: ...</span>
        </footer>
    </div>

    <!-- CHOICE MODAL -->
    <div id="downloadModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white max-w-md w-full rounded-2xl p-8 shadow-2xl border-4 border-blue-900 transform scale-100 transition-transform">
            <h3 class="header-font text-2xl font-bold mb-4 text-black text-center">Agreement Secured</h3>
            <p class="text-gray-600 mb-8 text-center text-lg">Would you like a local copy of this document for your personal records?</p>
            <div class="grid grid-cols-2 gap-4">
                <button id="noDownload" class="py-3 px-6 rounded-lg font-black text-gray-500 hover:bg-gray-100 transition-colors border-2 border-gray-200 uppercase text-xs tracking-widest">No, Skip</button>
                <button id="yesDownload" class="py-3 px-6 rounded-lg font-black bg-blue-900 text-white hover:bg-black transition-colors shadow-lg uppercase text-xs tracking-widest">Yes, Download</button>
            </div>
        </div>
    </div>

    <!-- HIDDEN CAPTURE BUFFER -->
    <div id="capture-buffer">
        <div class="watermark" style="color: rgba(0,0,0,0.03); font-size: 15rem;">DNS</div>
        
        <div style="display: flex; justify-content: space-between; font-family: monospace; font-size: 10px; color: #666; margin-bottom: 50px; text-transform: uppercase; letter-spacing: 2px;">
            <div id="buffer-id">ID: ...</div>
            <div>STATUS: OFFICIAL ORIGINAL RECORD</div>
        </div>

        <div style="text-align: center; margin-bottom: 60px; display: flex; flex-direction: column; align-items: center;">
            <div style="width: 80px; height: 80px; background: #1e3a8a; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 24px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            </div>
            <h1 class="header-font" style="font-size: 48px; color: black; margin: 0; font-weight: bold;">Partnership Agreement</h1>
            <p style="color: #1e3a8a; font-weight: bold; letter-spacing: 5px; font-size: 12px; margin-top: 15px; text-transform: uppercase;">DIAMOND NATION STUDIOS • LEGAL DEPARTMENT</p>
        </div>

        <div style="font-size: 18px; line-height: 1.8; color: black; border-left: 6px solid #1e3a8a; padding-left: 40px; margin-bottom: 40px;">
            <p style="margin-bottom: 25px;">
                By entering a partnership with <span style="font-weight: bold; color: #1e3a8a;">Diamond Nation Studios</span>, your server agrees to meet and maintain the eligibility requirement of having at least <span style="font-weight: bold; text-decoration: underline;">fifteen members</span>, unless an exception is formally approved by the Founders of Diamond Nation Studios.
            </p>
            <p style="margin-bottom: 25px;">
                Upon acceptance, you are required to fully comply with all branding standards set by DNS, which includes the mandatory use of all provided logos, decals, and promotional materials exactly as delivered, without alteration or redistribution of any kind. 
            </p>
            <p style="margin-bottom: 25px;">
                Additionally, your server must establish a role titled <span style="font-weight: bold; color: #1e3a8a;">"Diamond Nation"</span>, designated as the highest administrative role in your server, equipped with full administrative permissions to ensure proper oversight and coordination with DNS leadership. 
            </p>
            <p style="margin-bottom: 25px;">
                All logos, decals, and branding assets remain the exclusive property of Diamond Nation Studios. Misuse of assets, failure to uphold branding requirements, or refusal to maintain proper administrative structure may result in <span style="font-weight: bold; color: #b91c1c; text-transform: uppercase; text-decoration: underline;">immediate removal</span> from the program.
            </p>
            <p>
                If the partnership is terminated, you are required to remove and replace every DNS-provided asset from your server, game, and documents within <span style="font-weight: bold; text-decoration: underline;">48 hours</span>. 
            </p>
        </div>

        <div style="margin-bottom: 50px; padding-left: 40px;">
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <div style="width: 20px; height: 20px; border: 2px solid black; background: #1e3a8a; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4"><path d="M5 13l4 4L19 7"/></svg>
                </div>
                <span style="font-size: 14px; font-weight: bold;">Confirmed: Server maintains 15+ members requirement.</span>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="width: 20px; height: 20px; border: 2px solid black; background: #1e3a8a; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4"><path d="M5 13l4 4L19 7"/></svg>
                </div>
                <span style="font-size: 14px; font-weight: bold;">Confirmed: Agreed to 48-hour asset removal policy.</span>
            </div>
        </div>

        <!-- CAPTURE SIGNATURE SECTION: FIXED POSITIONAL LOGIC -->
        <div style="border-top: 2px solid black; margin-top: 40px; padding-top: 15px; position: relative; height: 160px;">
            <!-- Official Signature Label -->
            <label style="font-size: 10px; font-weight: bold; color: #1e3a8a; text-transform: uppercase; letter-spacing: 2px; position: absolute; top: 15px; left: 0;">Official Signature</label>
            
            <!-- Signature Placement: Flex-end ensures it sits ON the line -->
            <div style="position: absolute; bottom: 65px; left: 0; min-width: 450px; display: flex; align-items: flex-end; height: 100px;">
                <span id="buffer-signature" class="signature-font" style="color: black; white-space: nowrap;"></span>
            </div>

            <!-- Footer Text below the signature line -->
            <div style="position: absolute; bottom: 0; width: 100%; display: flex; justify-content: space-between; align-items: flex-end;">
                <div>
                    <p style="font-size: 8px; color: #999; text-transform: uppercase; margin: 0;">Verified digital signature of representative</p>
                </div>
                <div style="text-align: right;">
                    <p id="buffer-date" style="font-family: monospace; font-weight: bold; font-size: 14px; margin: 0; color: black;"></p>
                    <p style="font-size: 10px; color: #666; margin: 0; margin-top: 4px; text-transform: uppercase; letter-spacing: 1px;">DIGITALLY SECURED & ARCHIVED</p>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="fixed top-8 right-8 px-8 py-4 rounded-lg shadow-2xl text-white font-bold transform transition-all translate-x-[150%] z-50"></div>

    <script>
        const docId = "DNS-" + Array.from({length: 3}, () => Math.random().toString(36).substr(2, 4).toUpperCase()).join("-");
        const webhookUrl = "https://discord.com/api/webhooks/1476955076202463282/5LShV9nF7d9C2ivqkt_gFqtxv31A03OmTCkEEtBLANaK3CVXZPiW9gnc4SnHVjYUj0g8";
        
        document.getElementById('display-id').innerText = "ID: " + docId;
        document.getElementById('footer-id').innerText = "DOC-ID: " + docId;
        document.getElementById('buffer-id').innerText = "ID: " + docId;

        const dateStr = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('currentDate').innerText = dateStr;
        document.getElementById('buffer-date').innerText = dateStr.toUpperCase();
        document.getElementById('year').innerText = new Date().getFullYear();

        const check1 = document.getElementById('check1');
        const check2 = document.getElementById('check2');
        const usernameInput = document.getElementById('discordUsername');
        const submitBtn = document.getElementById('submitBtn');
        const modal = document.getElementById('downloadModal');

        let globalBlob = null;
        let globalUsername = "";

        function validateForm() {
            submitBtn.disabled = !(check1.checked && check2.checked && usernameInput.value.trim().length > 0);
        }

        [check1, check2, usernameInput].forEach(el => {
            el.addEventListener('input', validateForm);
            el.addEventListener('change', validateForm);
        });

        function showNotification(msg, err = false) {
            const n = document.getElementById('notification');
            n.innerText = msg;
            n.className = `fixed top-8 right-8 px-8 py-4 rounded-lg shadow-2xl text-white font-bold transform transition-all z-50 ${err ? 'bg-red-600' : 'bg-blue-900'}`;
            n.style.transform = "translateX(0)";
            setTimeout(() => { n.style.transform = "translateX(150%)"; }, 4000);
        }

        document.getElementById('signatureForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            globalUsername = usernameInput.value;
            
            submitBtn.disabled = true; 
            submitBtn.innerText = "CAPTURING ARCHIVE...";
            document.getElementById('buffer-signature').innerText = globalUsername;

            try {
                await new Promise(r => setTimeout(r, 600)); 

                const canvas = await html2canvas(document.getElementById('capture-buffer'), {
                    scale: 3,
                    backgroundColor: "#ffffff",
                    useCORS: true,
                    logging: false
                });

                globalBlob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.95));
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            } catch (err) {
                showNotification("CAPTURE FAILED", true);
                submitBtn.disabled = false;
            }
        });

        document.getElementById('yesDownload').addEventListener('click', () => {
            const url = URL.createObjectURL(globalBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DNS_Signed_Agreement_${globalUsername.replace(/\s+/g, '_')}.jpg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            proceedToWebhook();
        });

        document.getElementById('noDownload').addEventListener('click', () => {
            proceedToWebhook();
        });

        async function proceedToWebhook() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            submitBtn.innerText = "UPLOADING TO REGISTRY...";

            try {
                const formData = new FormData();
                formData.append('payload_json', JSON.stringify({
                    username: "DNS Partnership Registry",
                    content: `## ♣ PARTNERSHIP RECORD ARCHIVED ♣\n**Representative:** \`${globalUsername}\`\n**ID:** \`${docId}\``,
                    embeds: [{
                        title: "OFFICIAL SIGNED AGREEMENT",
                        color: 2123412,
                        image: { url: "attachment://signed.jpg" },
                        timestamp: new Date().toISOString()
                    }]
                }));
                formData.append('file', globalBlob, 'signed.jpg');

                const res = await fetch(webhookUrl, { method: 'POST', body: formData });

                if (res.ok) {
                    showNotification("RECORD SECURED");
                    document.getElementById('ui-container').innerHTML = `
                        <div class="text-center py-24 animate-pulse">
                            <div class="w-20 h-20 bg-blue-900 text-white rounded-full flex items-center justify-center mx-auto mb-8">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" stroke-width="3"/></svg>
                            </div>
                            <h2 class="header-font text-4xl font-bold mb-4">Registry Updated</h2>
                            <p class="font-mono text-blue-900 text-xl">${docId}</p>
                        </div>
                    `;
                } else { throw new Error(); }
            } catch (err) {
                showNotification("UPLOAD FAILED", true);
                submitBtn.disabled = false;
                submitBtn.innerText = "RETRY UPLOAD";
            }
        }
    </script>
</body>
</html>
